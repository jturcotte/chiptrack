// Copyright Â© 2021 Jocelyn Turcotte <turcotte.j@gmail.com>
// SPDX-License-Identifier: MIT

import { InstrumentData, GlobalEngine } from "globals.slint";

component InstrumentButton inherits Rectangle {
    callback pressed();
    callback right_pressed();
    in property<string> id;
    in property<bool> highlighted;
    in property<bool> active;
    in property<bool> muted;
    width: self.height;
    background: active ? #e0e0e0 : white;
    border_color: highlighted ? black : #a0a0a0;
    border_width: 1px;
    border_radius: self.width/16;
    Text {
        text: muted ? "ðŸ”‡" : id;
        width: 100%;
        height: 100%;
        font_size: self.height / 4;
        horizontal_alignment: center;
        vertical_alignment: center;
        color: muted ? #a0a0a0 : black;
    }
    TouchArea {
        width: 100%;
        height: 100%;
        pointer-event(e) => {
            if (e.kind == PointerEventKind.down) {
                if (e.button == PointerEventButton.left) {
                    root.pressed();
                } else if (e.button == PointerEventButton.right) {
                    root.right_pressed();
                }
            }
        }
    }
}

export component InstrumentsPanel inherits Flickable {
    property<length> spacing: 5px;
    property<int> grid_size: 4;
    property<length> item_size: (self.width - (spacing * (grid_size - 1))) / grid_size;
    viewport_height: item_size * (GlobalEngine.instruments.length / 4) + (GlobalEngine.instruments.length / 4 - 1) * spacing;
    interactive: false;

    for instrument[idx] in GlobalEngine.instruments:
    InstrumentButton {
        id: instrument.id;
        highlighted: idx == GlobalEngine.current_instrument;
        active: instrument.active;
        muted: instrument.muted;
        pressed => { GlobalEngine.select_instrument(idx); }
        right_pressed => { GlobalEngine.toggle_mute_instrument(idx); }
        x: mod(idx, 4) * (self.width + parent.spacing);
        y: floor(idx / 4) * (self.height + parent.spacing);
        height: parent.item_size;
    }
}
